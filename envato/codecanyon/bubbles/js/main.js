window.BUBBLES=window.BUBBLES||{};BUBBLES.Language={moreGames:"More Games",noNameDesc:"Please fill in your name to submit score",sendingData:"Sending data",nicknameOrName:"name or nickname",submit:"Submit",giveNameDesc:"Submit result on leaderboard",moreGames:"More Games",langCode:"en-gb",addCoinsBuyRestorePack:"Add %s & refill now!",again:"Again",back:"Back",backToMainMenu:"Back to main Menu",bombDesc:"Destroys 9 gems within range",bushidoDesc:"Developed By UDX",buyABooster:"BUY A BOOSTER",buyMore:"buy more",buyMoreCoins:"Buy Here",buyMoreCoinsInOurShop:"buy more in our shop",buyNow:"Buy now!",buyRestorePack:"Refill now!",cancel:"Cancel",close:"Close",coins:"Coins",colorDesc:"Destroys all gems of selected color","continue":"Continue",credits:"Credits",gainedCoins:"Gained",getMoreTools:"GET MORE BOOSTERS!",gettingData:"Getting data",hintDesc:"Tells which move you can&nbsp;do next",howToPlay:"How to play",inviteFriends:"Invite friends",leaderboard:"Leaderboard",leaderBoardUpdate:"Updated every 10 min.",letsUseThem:"Let's use them",level:"Level",loading:"Loading",mainMenu:"Main Menu",newHighscore:"NEW HIGHSCORE!",next:"Next",noLevelDesc1:"You need higher level to use this booster",noLevelDesc2:"Just play and have fun to gain experience points!",noMoreMoves:"No more moves!",noMoreMovesDesc:"No more moves, but you can use some boosters",noMoreResults:"No more results",NotEnoughCoins:"Not enough",ok:"OK",or:"or",page:"Page",pause:"Pause",play:"Play",popHowToPlayDesc1:"Look out for timer",popHowToPlayDesc2:"Put 3 gems in the row",popHowToPlayDesc3:"And have fun!",popHowToToolsDesc1:"GREAT!",popHowToToolsDesc2:"You have earned",popHowToToolsDesc3:"Here You can buy tools",price:"Price",restoreExplanation1:"No more lives left!",restoreExplanation2:"Please wait",restoreExplanation3:"JUST FOR",score:"Score",scores:"Scores",shop:"Shop",somethingWentWrong:"Something went wrong",stage:"Stage",timeOver:"Time Over!",timersDesc:"Adds extra seconds",toolFound:"Booster Found!",tools:"Boot",tryAgain:"Try Again",youBoughtNewTools:"You bought new boosters",share:"Share",shared:"Shared!",apiPostText:"I scored %SCORE% points in Bubbles In Table. Try to do better. I dare you!",bubbles:"Bubbles - HTML5 Mobile Game"};BUBBLES.Config={fKey:"#",serverUrl:"#"};(function(a){a.onerror=function(e,c,b){if(encodeURIComponent){var d="msg="+encodeURIComponent(e)+"&url="+encodeURIComponent(c)+"&line="+b+"&_"+ +new Date();document.createElement("img").src="#"+d;}
return false;};})(this);window.BUBBLES=window.BUBBLES||{};BUBBLES.Mobile=BUBBLES.Mobile||{};BUBBLES.Mobile.XHR=(function(){xhrClass=function(a){this.params=a;this.init();};xhrClass.prototype={init:function(){var a=this.params;a.method=a.method||"GET";a.onSuccess=a.onSuccess||function(){};a.onError=a.onError||function(){};a.url+=(a.url.match(/\?/)?"&":"?")+"fKey="+a.fKey+"&lang="+BUBBLES.Language.langCode+"&_="+Math.random();this.xhr=new XMLHttpRequest();this.xhr.onerror=a.onError;this.xhr.onreadystatechange=function(){if(4===this.xhr.readyState){var b=this.xhr.responseText&&JSON.parse(this.xhr.responseText);if(b.redirect){window.location.href=b.redirect;return;}
a.onSuccess(b);}}.bind(this);this.xhr.open(a.method,a.url,true);if("POST"===a.method){this.xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");}},send:function(a){this.xhr.send(a||this.params.data);}};return xhrClass;}());window.BUBBLES=window.BUBBLES||{};BUBBLES.Mobile=BUBBLES.Mobile||{};BUBBLES.Mobile.Utils={preventDocumentMoves:function(){function a(b){if("INPUT"!==b.srcElement.nodeName){b.preventDefault();}}
$("gameWrapper").addEventListener("touchmove",a,false);$("gameWrapper").addEventListener("touchstart",a,false);$("gameWrapper").addEventListener("touchend",a,false);},beforeUnload:function(){window.onbeforeunload=function(){return"Are you sure you want to leave game. All progress will not be saved";};},addClass:function(a,b){if(!a||!b){return false;}
BUBBLES.Mobile.Utils.removeClass(a,b);a.className+=(a.className?" ":"")+b;},removeClass:function(c,d){if(!c){return false;}
var b=c.className.split(" ");var a=b.indexOf(d);if(-1===a){return;}
b.splice(a,1);c.className=b.join(" ");},isObjEmpty:function(a){for(var b in a){if(a.hasOwnProperty(b)){return false;}}
return true;},hasClass:function(b,a){if(b.className.indexOf(a)>-1){return true;}
return false;},hideURLbar:function(){if(navigator.userAgent.match(/Android/i)){window.scrollTo(0,0);document.body.style.height=(window.outerHeight-250)+"px";window.scrollTo(0,1);}},hasChildElements:function(a){var b,c;b=false;for(c=a.firstChild;c;c=c.nextSibling){if(c.nodeType==1){b=true;break;}}
return b;},createCookie:function(c,d,e){if(e){var b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));var a="; expires="+b.toGMTString();}else{var a="";}
document.cookie=c+"="+d+a+"; path=/";},readCookie:function(b){var e=b+"=";var a=document.cookie.split(";");for(var d=0;d<a.length;d++){var f=a[d];while(f.charAt(0)==" "){f=f.substring(1,f.length);}
if(f.indexOf(e)==0){return f.substring(e.length,f.length);}}
return null;},getCoords:function(a){return{x:a.touches[0].clientX,y:a.touches[0].clientY};},rand:function(b,a){return Math.floor(Math.random()*(a-b+1))+b;},arrayInclude:function(a,b){if(-1===a.indexOf(b)){a.push(b);}
return a;},arrayCombine:function(d,b){if(b.length>0){for(var c=0,a=b.length;c<a;c++){d=this.arrayInclude(d,b[c]);}}
return d;},arrayErase:function(c,b){for(var a=c.length;a--;){if(c[a]===b){c.splice(a,1);}}
return this;},cleanElement:function(d,b){b=b||false;var a=d.parentNode;if(!a){return false;}
var c=d.cloneNode(b);a.insertBefore(c,d);a.removeChild(d);},inherit:function(b,f,a){var c=function(){};c.prototype=b.prototype;f.prototype=new c();for(var d in a){if(a.hasOwnProperty(d)){f.prototype[d]=a[d];}}},implement:function(b,f,a){var c=function(){};c.prototype=b.prototype;f.prototype=new c();for(var d in a){f.prototype[d]=a[d];}},cloneObj:function(d){if(typeof d!=="object"||d==null){return d;}
var f=d instanceof Array?[]:{};for(var b in d){var e=d[b];if(typeof e=="object"){if(e instanceof Array){f[b]=[];for(var a=0;a<e.length;a++){if(typeof e[a]!="object"){f[b].push(e[a]);}else{f[b].push(this.cloneObj(e[a]));}}}else{f[b]=this.cloneObj(e);}}else{f[b]=e;}}
return f;},getUrlVars:function(){var b={};var a=window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(c,d,e){b[d]=e;});return b;},animateCounter:function(c){c.duration=c.duration||3000;c.freq=c.freq||200;var b=parseInt(c.fromVal)||0,f=parseInt(c.byVal)||0,e=Math.floor(c.duration/c.freq),d=Math.floor(f/e)||1;var a=setInterval(function(){f-=d;b+=d;if(f<1){clearInterval(a);a=false;b+=f;f=0;}
if(c.fromEl){c.fromEl.innerHTML=f;}
c.toEl.innerHTML=b;if(f<1&&"function"===typeof(c.onComplete)){c.onComplete();}},c.freq);setTimeout(function(){if(false===a){return false;}
clearInterval(a);a=false;if(c.fromEl){c.fromEl.innerHTML=0;}
c.toEl.innerHTML=(parseInt(c.fromVal)||0)+(parseInt(c.byVal)||0);},c.duration*2);}};if(!Function.prototype.bind){Function.prototype.bind=function(c){var a=this,b=(arguments.length>1)?Array.prototype.slice.call(arguments,1):[];return function(){if(arguments.length>0){b=b.concat(Array.prototype.slice.call(arguments));}
return a.apply(c,b);};};}
var $=function(a){return document.getElementById(a);};window.BUBBLES=window.BUBBLES||{};BUBBLES.Mobile=BUBBLES.Mobile||{};BUBBLES.Mobile.Fonts={init:function(){this.adjustFont();window.addEventListener("resize",this.adjustFont,false);},adjustFont:function(){var a=$("gameWrapper").offsetHeight*0.212;$("gameWrapper").style.fontSize=a+"%";}};BUBBLES.Ads=(function(){var c=["cgAds1","cgAds2","cgAds3"];var a=function(){var j=Math.floor(Math.random()*10);if(j<4){var h=$("cgAds1");var f=document.createElement("script");f.type="text/javascript";f.src=BUBBLES.Config.serverUrl+"#";h.appendChild(f);for(var g=0,e=c.length;g<e;g++){var h=$(c[g]);BUBBLES.Mobile.Utils.removeClass(h,"hidden");BUBBLES.Mobile.Utils.removeClass(h.querySelector(".google"),"hidden");}}else{for(var g=0,e=c.length;g<e;g++){var h=$(c[g]);var k=$(c[g]).querySelector(".otherAd");var d=document.createElement("IFRAME");d.setAttribute("src","#");d.className="iframe1";k.appendChild(d);BUBBLES.Mobile.Utils.removeClass(k,"hidden");BUBBLES.Mobile.Utils.removeClass(h,"hidden");}}};var b=function(){a();};b.prototype={};return b;}());window.BUBBLES=window.BUBBLES||{};BUBBLES.Mobile=BUBBLES.Mobile||{};BUBBLES.Mobile.Spinner={el:{},opened:0,show:function(a,b){if(!this.el.spinner){this.el.spinner=$("spinner");this.el.spinnerDesc=$("spinnerDesc");BUBBLES.Mobile.Events.add(this.el.spinner,"touchstart",function(c){BUBBLES.Mobile.Utils.removeClass(this.el.spinner,"secret");}.bind(this));}
this.opened++;this.el.spinnerDesc.innerHTML=a||"";BUBBLES.Mobile.Utils.removeClass(this.el.spinner,"hidden");true===b?BUBBLES.Mobile.Utils.addClass(this.el.spinner,"secret"):null;},hide:function(){this.opened--;if(0===this.opened){BUBBLES.Mobile.Utils.removeClass(this.el.spinner,"secret");BUBBLES.Mobile.Utils.addClass(this.el.spinner,"hidden");}}};window.BUBBLES=window.BUBBLES||{};BUBBLES.Mobile=BUBBLES.Mobile||{};BUBBLES.Mobile.Events={add:function(c,b,a){c.addEventListener(b,a);},tap:function(a){if(!a||!a.element||!a.action){return false;}
a.element.addEventListener("touchstart",function(b){b.preventDefault();BUBBLES.Mobile.Utils.addClass(a.element,"tapView");},false);a.element.addEventListener("touchend",function(b){b.preventDefault();BUBBLES.Mobile.Utils.removeClass(a.element,"tapView");a.action(b);},false);}};window.BUBBLES=window.BUBBLES||{};BUBBLES.Mobile=BUBBLES.Mobile||{};BUBBLES.Mobile.Debug={SCREEN_SIZES:{GalaxyS:{width:480,height:800},IPhone13:{width:320,height:480},MotorolaDroid:{width:480,height:854},Iphone4:{width:640,height:960},"320x396":{width:320,height:396},"240x320":{width:240,height:320},"480x731":{width:480,height:732},"480x678":{width:480,height:678}},init:function(){this.createSettingsBox();this.setUpEvents();this.setStyles();this.setUtils();this.setSizes();this.setupPause();},setupPause:function(){BUBBLES.Pause.prototype.onOrientationChange=function(){};},setSizes:function(){var a=document.getElementById("gameWrapper");if(!a){return false;}
a.style.width=BUBBLES.Mobile.Debug.SCREEN_SIZES.IPhone13.width+"px";a.style.height=BUBBLES.Mobile.Debug.SCREEN_SIZES.IPhone13.height+"px";},setStyles:function(){var a=document.createElement("link");a.setAttribute("rel","stylesheet");a.setAttribute("type","text/css");a.setAttribute("href","#");document.getElementsByTagName("head")[0].appendChild(a);},createSettingsBox:function(){var c=document.createElement("div");c.style.position="absolute";c.style.top="0px";c.style.right="0px";c.style.width="100px";c.style.zIndex=10000;c.style.backgroundColor="#A1B3BD";var b,d,a;for(key in this.SCREEN_SIZES){b=document.createElement("input");b.type="button";b.value=key;b.onclick=function(f){var e=f.target.value;document.getElementById("gameWrapper").style.width=BUBBLES.Mobile.Debug.SCREEN_SIZES[e].width+"px";document.getElementById("gameWrapper").style.height=BUBBLES.Mobile.Debug.SCREEN_SIZES[e].height+"px";};c.appendChild(b);}
b=document.createElement("input");b.type="button";b.value="reset";b.onclick=function(e){document.getElementById("gameWrapper").style.width="";document.getElementById("gameWrapper").style.height="";};c.appendChild(b);document.body.appendChild(c);},setUpEvents:function(){if("ontouchstart"in window){return false;}
BUBBLES.Mobile.Events={add:function(c,b,a){b="touchstart"==b?"mousedown":b;b="touchend"==b?"mouseup":b;c.addEventListener(b,a,false);},tap:function(a){if(!a||!a.element||!a.action){return false;}
a.element.addEventListener("mousedown",function(b){b.preventDefault();BUBBLES.Mobile.Utils.addClass(a.element,"tapView");},false);a.element.addEventListener("mouseup",function(b){b.preventDefault();BUBBLES.Mobile.Utils.removeClass(a.element,"tapView");a.action(b);},false);}};},setUtils:function(){BUBBLES.Mobile.Utils.getCoords=function(a){return{x:a.clientX,y:a.clientY};};}};if(!("ontouchstart"in window)){window.addEventListener("load",BUBBLES.Mobile.Debug.init.bind(BUBBLES.Mobile.Debug),true);var $=function(a){return document.getElementById(a)||console.warn(a);};}(function(){if(window.location.host.match(/^stable\..+bushidoit\.com$/i)){BUBBLES.Config={fKey:"#",serverUrl:"#"};}else{if(window.location.host.match(/^test\..+bushidoit\.com$/i)){BUBBLES.Config={fKey:"#",serverUrl:"#"};}else{if(window.location.host.match(/local\.com$/i)){BUBBLES.Config={fKey:"#",serverUrl:"#"};}}}})();window.BUBBLES=window.BUBBLES||{};BUBBLES.Mobile=BUBBLES.Mobile||{};BUBBLES.Mobile.Anal={_getPageTracker:function(){if(!window._gaq){return false;}
if(!this.pageTracker&&window._gaq&&"function"===typeof window._gaq._getAsyncTracker){this.pageTracker=window._gaq._getAsyncTracker();}
return this.pageTracker;},track:function(a){var b=this._getPageTracker();if(!b){return false;}
b._trackPageview(a);return true;}};BUBBLES.EventEmitter=(function(){var a=function(){};a.prototype={addListener:function(b,c){if(!this._listeners){this._listeners={};}
if(typeof this._listeners[b]=="undefined"){this._listeners[b]=[];}
this._listeners[b].push(c);},fire:function(e){if(!this._listeners){this._listeners={};}
if(typeof e=="string"){e={type:e};}
if(!e.target){e.target=this;}
if(!e.type){throw new Error("Event object missing 'type' property.");}
if(this._listeners[e.type]instanceof Array){var d=this._listeners[e.type];for(var c=0,b=d.length;c<b;c++){d[c].apply(this,arguments);}}},removeListener:function(e,f){if(this._listeners[e]instanceof Array){var d=this._listeners[e];for(var c=0,b=d.length;c<b;c++){if(d[c]===f){d.splice(c,1);break;}}}}};return a;}());BUBBLES.Storage=(function(){var b=function(c){var d=localStorage.getItem("BUBBLES.Storage.allKeys")||";";var e=new RegExp(";"+c+";");if(e.test(d)){return true;}
d+=c+";";localStorage.setItem("BUBBLES.Storage.allKeys",d);};var a=function(c){this.config=c;this.init();};a.prototype={init:function(){this.synced=false;},setOAuthToken:function(c){this.oAuthToken=c;if(this.oAuthToken!==localStorage.getItem("BUBBLES.Storage.lastOAuthToken")){this.clear();}
localStorage.setItem("BUBBLES.Storage.lastOAuthToken",this.oAuthToken);},getOAuthToken:function(){return this.oAuthToken;},setFrontendKey:function(c){this.fKey=c;},getFrontendKey:function(){return this.fKey;},setRawItem:function(d,c){localStorage.setItem(d,c);b(d);},setItem:function(e,d,c){var f=JSON.stringify(d);this.setRawItem(e,f);if(true!==c){this.sync({key:e,value:f});}},getItem:function(c,d){var e=localStorage.getItem(c);if(e&&true!==d){e=JSON.parse(e);}
return e;},sync:function(c){c.value=c.value||this.getItem(c.key,true);var g="set";if(null===c.value){g="get";}
var f=this.getOAuthToken();if(!f){console.error("BUBBLES.Store: no oAuthToken");return false;}
c.value=encodeURI(c.value);var e="key="+c.key+"&value="+c.value+"&oAuthToken="+f+"&time=&_="+Math.random();var d=new BUBBLES.Mobile.XHR({fKey:this.getFrontendKey(),url:BUBBLES.Config.serverUrl+"?fKey="+this.getFrontendKey()+"&a="+g+"Storage",method:"POST",onSuccess:function(h){if("set"!==g){try{this.setItem(c.key,h,true);}catch(i){console.error(i);xhr.onerror();}}
if(c.onSuccess){c.onSuccess(h);}
return false;}.bind(this),onError:function(){if(c.onError){c.onError();}}});d.send(e);},clear:function(){var e=localStorage.getItem("BUBBLES.Storage.allKeys")||";";e=e.split(";");for(var d=1,c=e.length-1;d<c;d++){localStorage.removeItem(e[d]);}
localStorage.setItem("BUBBLES.Storage.allKeys",";");}};return a;}());BUBBLES.App=(function(){var a=function(){this.init();};a.prototype={init:function(){this.loader=new BUBBLES.Loader();this.storeInitParams();window.location.hash="LOADING";BUBBLES.Mobile.Fonts.init("HelsinkiRegular");BUBBLES.Lang.loadLanguage();BUBBLES.Mobile.Utils.preventDocumentMoves();document.title=BUBBLES.Language.bubbles;this.storage=new BUBBLES.Storage({server:BUBBLES.Config.serverUrl});this.pages=new BUBBLES.Pages();this.pause=new BUBBLES.Pause();this.trigger=new BUBBLES.Triggers("ga2Counter",["one","two"]);this.leaderBoard=new BUBBLES.LeaderBoard();this.game=new BUBBLES.Game(this.pages);new BUBBLES.API.General(this);this.loader.turboLoad();this.setupFlowEvents();setTimeout(this.pause.checkStartOrientation.bind(this.pause),700);},storeInitParams:function(){var b=window.location.hash.match(/_pp(.+)/);if(!b||!b[1]){return false;}
if("rl"===b[1]){this.loader.addListener("onLoad",function(){this.fire("apiRestoredLifes");this.pages.show("BEFOREPLAY");}.bind(this));}else{if("sh"===b[1]){this.loader.addListener("onLoad",function(){this.pages.show("BEFOREPLAY");}.bind(this));}}},setupFlowEvents:function(){window.addEventListener("hashchange",this.pages.onShow.bind(this.pages),false);window.onunload=function(){};this.pause.addListener("onPause",function(){this.game.pause();this.pages.showPause();}.bind(this));this.pause.addListener("onStart",function(){this.game.unpause();this.pages.hidePause();}.bind(this));BUBBLES.Mobile.Events.tap({element:$("goBeforePlay"),action:function(){if("one"===this.trigger.getCurrentStep()){this.pages.show("PLAY",function(){this.game.newGame();this.game.pause();}.bind(this));this.pages.showPop("HOWTOPLAY");this.trigger.setComplete();}else{this.showBeforePlay();}}.bind(this)});BUBBLES.Mobile.Events.tap({element:$("goPlay"),action:this.game.checkLifes.bind(this.game)});BUBBLES.Mobile.Events.tap({element:$("goHowToPlay"),action:this.pages.show.bind(this.pages,"HOWTOPLAY1")});BUBBLES.Mobile.Events.tap({element:$("goHowToPlay2"),action:this.pages.show.bind(this.pages,"HOWTOPLAY2")});BUBBLES.Mobile.Events.tap({element:$("closeHowToPlay"),action:this.pages.show.bind(this.pages,"WELCOME")});BUBBLES.Mobile.Events.tap({element:$("shopOK"),action:this.pages.hidePop.bind(this.pages,"SHOPERROR")});BUBBLES.Mobile.Events.tap({element:$("shopPlay"),action:function(){this.pages.hidePop("SHOPSUCCESS");if(this.game.game){this.game.unpause(true);this.pages.show("PLAY");}else{this.pages.show("PLAY",this.game.newGame.bind(this.game));}}.bind(this)});BUBBLES.Mobile.Events.tap({element:$("goShop"),action:function(){BUBBLES.Mobile.Utils.removeClass($("closeShop"),"hidden");this.pages.show("SHOP");}.bind(this)});BUBBLES.Mobile.Events.tap({element:$("goInviteFirends"),action:this.fire.bind(this,"apiInviteFriends")});BUBBLES.Mobile.Events.tap({element:$("goScores"),action:this.fire.bind(this,"apiShowLeaderBoard")});BUBBLES.Mobile.Events.tap({element:$("goCredits"),action:this.pages.show.bind(this.pages,"CREDITS")});BUBBLES.Mobile.Events.tap({element:$("pause"),action:function(){this.pages.showPop("GAMEPAUSE");this.game.pause(true);}.bind(this)});BUBBLES.Mobile.Events.tap({element:$("gameContinue"),action:function(){this.pages.hidePop("GAMEPAUSE");this.game.unpause(true);}.bind(this)});BUBBLES.Mobile.Events.tap({element:$("back3"),action:this.pages.show.bind(this.pages,"WELCOME")});BUBBLES.Mobile.Events.tap({element:$("back1"),action:function(){this.game.remove();this.pages.hidePop("RESULT");this.pages.show("WELCOME");}.bind(this)});BUBBLES.Mobile.Events.tap({element:$("back2"),action:function(){this.pages.hidePop("RESULT");this.pages.show("WELCOME");}.bind(this)});BUBBLES.Mobile.Events.tap({element:$("playAgain"),action:this.showBeforePlay.bind(this)});BUBBLES.Mobile.Events.tap({element:$("play1"),action:function(){this.game.unpause();this.pages.hidePop("HOWTOPLAY");}.bind(this)});BUBBLES.Mobile.Events.tap({element:$("closeHelper1"),action:this.pages.hidePop.bind(this.pages,"HOWTOTOOLS")});BUBBLES.Mobile.Events.tap({element:$("scoreCancel"),action:this.pages.showPop.bind(this.pages,"RESULT")});BUBBLES.Mobile.Events.tap({element:$("scoreSubmit"),action:function(){var b=document.getElementById("nickname").value;if(!b){alert(BUBBLES.Language.noNameDesc);}else{var c=document.getElementById("submitPoints").innerHTML;this.fire("apiSubmitScore",c,b);this.pages.showPop("RESULT");}}.bind(this)});BUBBLES.Mobile.Events.tap({element:$("goMoreGames"),action:function(){var b=BUBBLES.Mobile.Utils.getUrlVars()["bm.source"];if(!b||b==""){b=window.location.host;}
b="http://codecanyon.net/collections/5204465-games?ref=UDX"+b;window.location.href=b;}.bind(this)});},showBeforePlay:function(){this.pages.hidePop("RESULT");this.game.lifes.fillDOM();this.game.toolsShop.refillDOM();if("two"===this.trigger.getCurrentStep()){$("howToToolsAmount").innerHTML=this.game.getCoins();this.pages.showPop("HOWTOTOOLS");this.trigger.setComplete();}
this.pages.show("BEFOREPLAY");}};BUBBLES.Mobile.Utils.inherit(BUBBLES.EventEmitter,a,a.prototype);return a;}());window.addEventListener("load",function(){BUBBLES.app=new BUBBLES.App();});BUBBLES.Lang=(function(){return{loadLanguage:function(){if(!BUBBLES.Language){return false;}
var d=document.getElementsByName("lang"),c,a,b;for(c=d.length-1;c>=0;c--){b=d[c];b.removeAttribute("name");b.innerHTML=BUBBLES.Language[b.title];}}};})();BUBBLES.Triggers=(function(){var a=function(b,c){this.init(b,c);};a.prototype={init:function(b,c){this.id=b;this.config=c;this.progress=localStorage.getItem("BUBBLES.Triggers."+this.id);},getCurrentStep:function(){var c=this.config,b=c.indexOf(this.progress);return c[b+1]||false;},setComplete:function(){var b=this.getCurrentStep();if(!b){return false;}
this.progress=b;localStorage.setItem("BUBBLES.Triggers."+this.id,this.progress);}};return a;}());BUBBLES.Pages=(function(){var b={LOADING:{id:"pageLoading",el:null,statusBar:false},WELCOME:{id:"pageWelcome",el:null,statusBar:false},HOWTOPLAY1:{id:"pageHowToPlay1",el:null,statusBar:false},HOWTOPLAY2:{id:"pageHowToPlay2",el:null,statusBar:false},SHOP:{id:"pageShop",el:null,statusBar:true},PLAY:{id:"pagePlay",el:null,statusBar:false},BEFOREPLAY:{id:"pageBeforePlay",el:null,statusBar:true},RESTORELIFES:{id:"pageRestoreLifes",el:null,statusBar:true,arrow:true},LEADERBOARD:{id:"pageLeaderBoard",el:null,statusBar:false,arrow:false},CREDITS:{id:"pageCredits",el:null,statusBar:false}};var d={GAMEPAUSE:{id:"popGamePause",el:null,statusBar:false},RESULT:{id:"popResult",el:null,statusBar:true},NOCOINS:{id:"popNoCoins",el:null,statusBar:true,arrow:true},NOLEVEL:{id:"popNoLevel",el:null,statusBar:true,arrow:true},SHOPSUCCESS:{id:"popShopSuccess",el:null,statusBar:false},SHOPERROR:{id:"popShopError",el:null,statusBar:false},HOWTOPLAY:{id:"popHowToPlay",el:null,statusBar:false},HOWTOTOOLS:{id:"popHowToTools",el:null,statusBar:true},SUBMITSCORE:{id:"popSubmitScore",el:null,statusBar:false}};var f=function(){for(key in b){b[key].el=$(b[key].id);}
for(key in d){d[key].el=$(d[key].id);}};var e=function(){for(key in b){BUBBLES.Mobile.Utils.addClass(b[key].el,"hidden");}};var c=function(){for(key in d){BUBBLES.Mobile.Utils.addClass(d[key].el,"hidden");}};var a=function(){f();};a.prototype={callbacks:{},show:function(g,h){if(b[g]&&b[g].el!==null){this.callbacks[g]=h;document.location.hash=g;}
BUBBLES.Mobile.Anal.track("/pages/"+g);},onShow:function(){var g=document.location.hash.split("#")[1];e();if(BUBBLES.app.game.game&&"PLAY"!==g){BUBBLES.app.game.pause();}
BUBBLES.Mobile.Utils.removeClass(b[g].el,"hidden");if("function"===typeof this.callbacks[g]){this.callbacks[g]();this.callbacks[g]=null;}
true===b[g].statusBar?this.showStatusBar():this.hideStatusBar();true===b[g].arrow?this.showArrow(g):this.hideArrow();},showPop:function(g){if(d[g]&&d[g].el!==null){BUBBLES.Mobile.Utils.removeClass($("pops"),"hidden");c();BUBBLES.Mobile.Utils.removeClass(d[g].el,"hidden");true===d[g].statusBar?this.showStatusBar():this.hideStatusBar();true===d[g].arrow?this.showArrow(g):this.hideArrow();}
BUBBLES.Mobile.Anal.track("/popup/"+g);},hidePop:function(g){if(d[g]&&d[g].el!==null){this.hideArrow();BUBBLES.Mobile.Utils.addClass($("pops"),"hidden");BUBBLES.Mobile.Utils.addClass(d[g].el,"hidden");}},showPause:function(){BUBBLES.Mobile.Utils.removeClass($("popPause"),"hidden");},hidePause:function(){BUBBLES.Mobile.Utils.addClass($("popPause"),"hidden");},showStatusBar:function(){BUBBLES.Mobile.Utils.removeClass($("statusBar"),"hidden");this.fire("onShowStatusBar");},hideStatusBar:function(){BUBBLES.Mobile.Utils.addClass($("statusBar"),"hidden");this.fire("onHideStatusBar");},showArrow:function(g){BUBBLES.Mobile.Utils.removeClass($("arrowIcon"),"hidden");BUBBLES.Mobile.Utils.removeClass($("arrowIcon"),"life");BUBBLES.Mobile.Utils.removeClass($("arrowIcon"),"money");if("RESTORELIFES"===g){BUBBLES.Mobile.Utils.addClass($("arrowIcon"),"life");}
if("NOCOINS"===g){BUBBLES.Mobile.Utils.addClass($("arrowIcon"),"money");}},hideArrow:function(){BUBBLES.Mobile.Utils.addClass($("arrowIcon"),"hidden");}};BUBBLES.Mobile.Utils.implement(BUBBLES.EventEmitter,a,a.prototype);return a;}());BUBBLES.Pause=(function(){var a=function(){this.init();};a.prototype={init:function(){var d=this;var b="onorientationchange"in window,c=b?"orientationchange":"resize";window.addEventListener(c,this.onOrientationChange.bind(this,null),false);},checkStartOrientation:function(){var d=document.body.offsetHeight;var b=document.body.offsetWidth;var c=0;if(d<b){c=90;}
this.onOrientationChange(c);},onOrientationChange:function(b){var b=b;if(b===null){b=window.orientation;}
if(0===b||180===b){this.fire("onStart");}else{this.fire("onPause");}}},BUBBLES.Mobile.Utils.inherit(BUBBLES.EventEmitter,a,a.prototype);return a;}());BUBBLES.Loader=(function(){var a=function(){this.init();};a.prototype={images:[],init:function(){this.el={loaderProgressBar:$("loaderProgressBar")};this.images=BUBBLES.Loader.Images;this.count=0;this.totalCount=0;this.registerData(this.images.length);},turboLoad:function(){this.load();this.load();this.load();},load:function(){var c=this.images.pop();if(!c){return;}
this.progress();if(c!=="endoffile"){var b=document.createElement("img");b.onload=this.load.bind(this);b.src=c;}else{this.load();}},progress:function(){this.count++;var b=~~(this.count*100/this.totalCount);if(100===b){this.hide();}else{this.el.loaderProgressBar.style.width=b+"%";}},registerData:function(b){b=b||1;this.totalCount+=b;},hide:function(){this.fire("onLoad");BUBBLES.Mobile.Utils.addClass($("loaderProgressContainer"),"hidden");BUBBLES.Mobile.Utils.removeClass($("loaderContinue"),"hidden");BUBBLES.Mobile.Events.tap({element:$("loaderContinue"),action:function(){BUBBLES.app.pages.show("WELCOME");}});}};BUBBLES.Mobile.Utils.implement(BUBBLES.EventEmitter,a,a.prototype);return a;}());BUBBLES.Loader.Images=["./img/CG2logo.png","./img/arrowIcon.png","./img/btn-tap.png","./img/btn.png","./img/btnRed-tap.png","./img/btnRed.png","./img/credits.png","./img/currencygemicon.png","./img/game/bomb.png","./img/game/color.png","./img/game/g1-tap.jpg","./img/game/g1.jpg","./img/game/g2-tap.jpg","./img/game/g2.jpg","./img/game/g3-tap.jpg","./img/game/g3.jpg","./img/game/g4-tap.jpg","./img/game/g4.jpg","./img/game/g5-tap.jpg","./img/game/g5.jpg","./img/game/g6-tap.jpg","./img/game/g6.jpg","./img/game/g7-tap.jpg","./img/game/g7.jpg","./img/game/g8-tap.jpg","./img/game/g8.jpg","./img/game/gameBG.jpg","./img/game/hint.png","./img/game/time10.png","./img/game/time1020.png","./img/game/time20.png","./img/gameIcons/cg-114x114.png","./img/gameIcons/iphone-72x72.png","./img/gameIcons/splash.png","./img/heartboxicon.png","./img/hearticon.png","./img/howto/four.png","./img/howto/one.png","./img/howto/three.png","./img/howto/two.png","./img/loaderBG.jpg","./img/loaderBG2.png","./img/loaderBG2inner.png","./img/loaderBGinner.jpg","./img/loaderBGinnerGreen.jpg","./img/mainBG.jpg","./img/popUpBg.jpg","./img/rotate.jpg","./img/scoreCircle.png","./img/spinner.png","./img/statusBG.jpg","endoffile"];BUBBLES.LeaderBoard=(function(){var a=function(){this.init();};a.prototype={perPage:8,init:function(){this.el={scoreList:$("scoreList"),prevScores:$("prevScores"),nextScores:$("nextScores")};this.actualCount=0;this.maxCount=false;this.setupFlowEvents();},setFrontendKey:function(b){this.fKey=b;},getFrontendKey:function(){return this.fKey;},getScores:function(){BUBBLES.Mobile.Spinner.show(BUBBLES.Language.gettingData);new BUBBLES.Mobile.XHR({fKey:this.getFrontendKey(),url:BUBBLES.Config.serverUrl+"?a=getScores",method:"POST",data:"count="+this.actualCount,onSuccess:function(b){this.maxCount=Math.floor(b.maxCount.players/this.perPage);this.setActualCount(0);this.fillDOM(b.scores);BUBBLES.Mobile.Spinner.hide();}.bind(this)}).send();},setupFlowEvents:function(){BUBBLES.Mobile.Events.tap({element:this.el.prevScores,action:this.prevScores.bind(this)});BUBBLES.Mobile.Events.tap({element:this.el.nextScores,action:this.nextScores.bind(this)});BUBBLES.Mobile.Events.tap({element:$("closeLeaderBoard"),action:function(){this.actualCount=0;this.setActualCount(0);window.history.back();}.bind(this)});},prevScores:function(){if(0===this.actualCount){return false;}
this.setActualCount(-1);this.getScores();},nextScores:function(){if(this.maxCount===this.actualCount){return false;}
this.setActualCount(1);this.getScores();},setActualCount:function(b){this.actualCount+=b;if(0===this.actualCount){BUBBLES.Mobile.Utils.addClass(this.el.prevScores,"notVisible");}else{BUBBLES.Mobile.Utils.removeClass(this.el.prevScores,"notVisible");}
if(this.maxCount===this.actualCount){BUBBLES.Mobile.Utils.addClass(this.el.nextScores,"notVisible");}else{BUBBLES.Mobile.Utils.removeClass(this.el.nextScores,"notVisible");}},fillDOM:function(d){console.log(d);var g="",f,e,h=this.actualCount*this.perPage;for(var c=0,b=d.length;c<b;c++){h++;f=d[c].Player.inventory||"img/noAvatar.png";e=d[c].Player.username;e=e.length>13?e.substr(0,13)+"...":e;e=e.replace(/\s/g,"&nbsp;");g+='<div class="centerH"><span class="count">'+h+'</span><img src="'+f+'"><span class="userName">'+e+'</span><span class="userScore">'+d[c].Player.best_score+"</span></div>";}
this.el.scoreList.innerHTML=g;}};BUBBLES.Mobile.Utils.implement(BUBBLES.EventEmitter,a,a.prototype);return a;}());BUBBLES.Lifes=(function(){var a=function(b){this.init(b);};a.prototype={price:50,defaultCount:3,regenerationTime:1800,usedLifes:[],init:function(b){this.gameRef=b;this.el={buyRestore:$("buyRestore"),refillPrice:$("refillPrice"),cancelRestore:$("cancelRestore"),heart1:$("heart1"),heart2:$("heart2"),heart3:$("heart3"),heartBox1:$("heartBox1"),heartBox2:$("heartBox2"),heartBox3:$("heartBox3")};this.gameRef.addListener("onSetData",this.onSetData.bind(this));this.loadLifes();this.setupFlowEvents();},onSetData:function(){if(1==localStorage.getItem("CG2RestoreLifes")){this.premiumReset();localStorage.setItem("CG2RestoreLifes",0);}
this.fillDOM();},setupFlowEvents:function(){this.gameRef.pagesRef.addListener("onShowStatusBar",this.showStatusBar.bind(this));this.gameRef.pagesRef.addListener("onHideStatusBar",this.hideStatusBar.bind(this));BUBBLES.Mobile.Events.tap({element:this.el.buyRestore,action:this.buy.bind(this)});BUBBLES.Mobile.Events.tap({element:this.el.cancelRestore,action:this.gameRef.pagesRef.show.bind(this.gameRef.pagesRef,"BEFOREPLAY")});},fillDOM:function(){var b=this.getAmount();this.el.refillPrice.innerHTML=this.price;if(this.gameRef.getCoins()>=this.price){this.el.buyRestore.innerHTML=BUBBLES.Language.buyRestorePack;}else{this.el.buyRestore.innerHTML=BUBBLES.Language.addCoinsBuyRestorePack.replace(/%s/,'<div class="myMoneyIcon"></div>');}
BUBBLES.Mobile.Utils.addClass(this.el.heart1,"hidden");BUBBLES.Mobile.Utils.addClass(this.el.heart2,"hidden");BUBBLES.Mobile.Utils.addClass(this.el.heart3,"hidden");BUBBLES.Mobile.Utils.removeClass(this.el.heart1,"heartMove");BUBBLES.Mobile.Utils.removeClass(this.el.heart2,"heartMove");BUBBLES.Mobile.Utils.removeClass(this.el.heart3,"heartMove");if(1===b){BUBBLES.Mobile.Utils.removeClass(this.el.heart1,"hidden");}
if(2===b){BUBBLES.Mobile.Utils.removeClass(this.el.heart1,"hidden");BUBBLES.Mobile.Utils.removeClass(this.el.heart2,"hidden");}
if(3===b){BUBBLES.Mobile.Utils.removeClass(this.el.heart1,"hidden");BUBBLES.Mobile.Utils.removeClass(this.el.heart2,"hidden");BUBBLES.Mobile.Utils.removeClass(this.el.heart3,"hidden");}
if(0===b){BUBBLES.Mobile.Utils.addClass(this.el.heartBox1,"heartBlink");BUBBLES.Mobile.Utils.addClass(this.el.heartBox2,"heartBlink");BUBBLES.Mobile.Utils.addClass(this.el.heartBox3,"heartBlink");}else{BUBBLES.Mobile.Utils.removeClass(this.el.heartBox1,"heartBlink");BUBBLES.Mobile.Utils.removeClass(this.el.heartBox2,"heartBlink");BUBBLES.Mobile.Utils.removeClass(this.el.heartBox3,"heartBlink");}},animateProperHeart:function(){var b=this.getAmount();if(1===b){BUBBLES.Mobile.Utils.addClass(this.el.heart1,"heartMove");}
if(2===b){BUBBLES.Mobile.Utils.addClass(this.el.heart2,"heartMove");}
if(3===b){BUBBLES.Mobile.Utils.addClass(this.el.heart3,"heartMove");}},getAmount:function(){return this.defaultCount-this.usedLifes.length;},useLife:function(){this.usedLifes.push(Math.round(+new Date()/1000)+this.regenerationTime);this.saveLifes();},showStatusBar:function(){if(0===this.usedLifes.length){return true;}
this.fillDOM();this.hideStatusBar();this.interval=setInterval(this.checkUsed.bind(this),1000);},hideStatusBar:function(){clearInterval(this.interval);},checkUsed:function(){var b=this.usedLifes[0]-Math.round(+new Date()/1000);this.fire("onTimeCount",b);if(b<1){this.usedLifes.shift();this.saveLifes();this.fillDOM();if(0===this.usedLifes.length){clearInterval(this.interval);}}},premiumReset:function(){var b=this.gameRef.getCoins();if(b<this.price){return false;}
this.gameRef.setCoins(b-this.price);this.gameRef.fire("apiSpendCoins",this.price);this.usedLifes=[];this.saveLifes();this.fillDOM();clearInterval(this.interval);this.gameRef.pagesRef.show("BEFOREPLAY");},saveLifes:function(){localStorage.setItem("CG2Lifes",JSON.stringify(this.usedLifes));},loadLifes:function(){var b=localStorage.getItem("CG2Lifes");this.usedLifes=(b&&JSON.parse(b))||[];},buy:function(){if(false===this.premiumReset()){localStorage.setItem("CG2RestoreLifes",1);this.gameRef.pagesRef.show("SHOP");return;}}};BUBBLES.Mobile.Utils.implement(BUBBLES.EventEmitter,a,a.prototype);return a;}());BUBBLES.Shop=(function(){var a=function(b){this.init(b);};a.prototype={config:{1:{price:10,coinsAmount:50},2:{price:75,coinsAmount:400},3:{price:200,coinsAmount:1200}},init:function(b){this.gameRef=b;this.fillDOM();this.setupFlowEvents();},setupFlowEvents:function(){BUBBLES.Mobile.Events.tap({element:$("closeShop"),action:function(){BUBBLES.Mobile.Utils.removeClass($("moneyAmount"),"colorBlink");window.history.back();}});BUBBLES.Mobile.Events.tap({element:$("buyMoreCoins"),action:function(){this.gameRef.pagesRef.show("SHOP");this.gameRef.pagesRef.hidePop("NOCOINS");}.bind(this)});BUBBLES.Mobile.Events.tap({element:$("buyMoreCoins2"),action:function(){this.gameRef.saveGameData();this.gameRef.pagesRef.show("SHOP");}.bind(this)});BUBBLES.Mobile.Events.tap({element:$("back4"),action:function(){BUBBLES.Mobile.Utils.removeClass($("moneyAmount"),"colorBlink");this.gameRef.pagesRef.hidePop("NOCOINS");}.bind(this)});BUBBLES.Mobile.Events.tap({element:$("close1"),action:this.gameRef.pagesRef.hidePop.bind(this.gameRef.pagesRef,"NOLEVEL")});},fillDOM:function(c){for(var b in this.config){$("coinsAmount"+b).innerHTML=this.getCoinsAmount(b);$("price"+b).innerHTML=this.getPrice(b);if(true===c){continue;}
BUBBLES.Mobile.Events.tap({element:$("shopBox"+b),action:this.buy.bind(this,b)});}},getCoinsAmount:function(b){return this.config[b].coinsAmount;},getPrice:function(b){return this.config[b].price;},buy:function(b){this.fire("apiBuyCoins",this.config[b]);}};BUBBLES.Mobile.Utils.implement(BUBBLES.EventEmitter,a,a.prototype);return a;}());BUBBLES.ToolsShop=(function(){var a=function(b){this.init(b);};a.prototype={config:{hint:{level:1,price:10},bomb:{level:1,price:25},time10:{level:2,price:10},time20:{level:4,price:15},color:{level:7,price:35}},boughtTools:{},spendCoins:0,init:function(b){this.gameRef=b;this.el={moneyAmount:$("moneyAmount")};this.gameRef.addListener("onSetData",this.onSetData.bind(this));this.resetBought();this.setUpEvents();},onSetData:function(){this.fillDOM();},setUpEvents:function(){for(var b in this.config){BUBBLES.Mobile.Events.tap({element:$(b+"Buy"),action:this.buy.bind(this,b)});}},fillDOM:function(){var c=this.gameRef.storage.getItem("CG2Tools")||{};var d=this.gameRef.getLevel()||1;for(var b in this.config){$(b+"Price").innerHTML=this.getPrice(b);if(this.getLevel(b)<=d){BUBBLES.Mobile.Utils.addClass($(b+"NeededLevel").parentNode,"hidden");}else{$(b+"NeededLevel").innerHTML=BUBBLES.Language.level+" "+this.getLevel(b);}
$(b+"Number").innerHTML=c[b]||0;}},refillDOM:function(){var c=this.gameRef.storage.getItem("CG2Tools")||{};var d=this.gameRef.getLevel();BUBBLES.Mobile.Utils.removeClass(this.el.moneyAmount,"colorBlink");for(var b in this.config){if(this.getLevel(b)<=d){BUBBLES.Mobile.Utils.addClass($(b+"NeededLevel").parentNode,"hidden");}
$(b+"Number").innerHTML=c[b]||0;}
this.resetBought();},resetBought:function(){var c=this.gameRef.storage.getItem("CG2Tools")||{};for(var b in this.config){this.boughtTools[b]=c[b]||0;}
this.spendCoins=0;},buy:function(c){var d=this.getPrice(c),b=this.gameRef.getCoins(),e=this.gameRef.getLevel();if(this.config[c].level>e){this.gameRef.pagesRef.showPop("NOLEVEL");return;}
if(b<d){BUBBLES.Mobile.Utils.addClass(this.el.moneyAmount,"colorBlink");this.gameRef.saveGameData();this.gameRef.pagesRef.showPop("NOCOINS");return;}
BUBBLES.Mobile.Anal.track("/game/buy/"+c);this.boughtTools[c]++;$(c+"Number").innerHTML=this.boughtTools[c];this.spendCoins+=d;this.gameRef.setCoins(b-d);},getBoughtTools:function(){return{coins:this.spendCoins,tools:this.boughtTools};},getPrice:function(b){return this.config[b].price;},getLevel:function(b){return this.config[b].level;}};return a;}());BUBBLES.Game=(function(){var d=function(e){e-=1;return((e*(e/4))*1000);};var b={lvl1:{mapSize:{x:8,y:8},gemCount:5,time:45,maxTime:60,timeInc:2,timeMultiplier:1,tools:{},onHaveToUseTool:function(){alert(BUBBLES.Language.noMoreMovesDesc);},pointsPerStage:2000},lvl2:{gemCount:5,timeMultiplier:1,pointsPerStage:2500},lvl3:{gemCount:6,timeInc:2,timeMultiplier:1,pointsPerStage:3000},lvl4:{gemCount:6,timeInc:3,timeMultiplier:2,pointsPerStage:3500},lvl5:{gemCount:6,timeInc:2,timeMultiplier:2,pointsPerStage:4000},lvl6:{gemCount:7,timeInc:2,timeMultiplier:2,pointsPerStage:5000},lvl7:{gemCount:7,timeInc:3,timeMultiplier:3},lvl8:{gemCount:8,timeInc:4,timeMultiplier:4}};var a=function(){var g=$("componentWrapper");var e=$("innerWrapper");var f;if(g.offsetWidth<g.offsetHeight){f=g.offsetWidth;}else{f=g.offsetHeight;}
e.style.height=f+"px";e.style.width=f+"px";};var c=function(e){this.pagesRef=e;this.init();};c.prototype={game:null,init:function(){this.el={gameInfo:$("gameInfo"),moneyAmount:$("moneyAmount"),userLevelExp:$("userLevelExp"),levelProgress:$("levelProgress"),endGainedCoins:$("endGainedCoins"),endScore:$("endScore"),endStage:$("endStage"),userLevelExpNeeded:$("userLevelExpNeeded"),userLevelValue:$("userLevelValue"),noMoves:$("noMoves"),noTime:$("noTime"),newRecord:$("newRecord"),stage:$("stage"),main:$("main"),score:$("score"),timerMin:$("timerMin"),timerSec:$("timerSec"),submitPoints:$("submitPoints"),nickname:$("nickname"),};this.lastScore=0;this.storage=new BUBBLES.Storage({server:BUBBLES.Config.serverUrl});this.shop=new BUBBLES.Shop(this);this.toolsShop=new BUBBLES.ToolsShop(this);this.lifes=new BUBBLES.Lifes(this);var e=this;this.lifes.addListener("onTimeCount",function(f,g){var h=Math.floor(g/60),i=g%60;h=h<10?"0"+h:h;i=i<10?"0"+i:i;e.el.timerMin.innerHTML=h;e.el.timerSec.innerHTML=i;});BUBBLES.Mobile.Events.add(this.el.gameInfo,"touchstart",this.hideGameInfo.bind(this));},setGameData:function(e,f){this.setCoins(e);this.setExp(f);this.fire("onSetData");},setCoins:function(f,e){this.coins=f;if(true!==e){this.el.moneyAmount.innerHTML=this.coins;}},getCoins:function(){return this.coins;},setExp:function(e){this.exp=e;this.setDOMExp(e);},getExp:function(){return this.exp;},getLevel:function(){return Math.floor(Math.sqrt((this.getExp()/1000)*4))+1;},getScore:function(){return this.storage.getItem("CG2Score");},pause:function(e){if(true===e){this.userPause=true;}
if(this.game){this.game.stopTimer();}},unpause:function(e){if(true===e){this.userPause=false;}
if(this.game&&true!==this.userPause){this.game.startTimer();}},remove:function(){if(this.game){this.game.remove();this.game=null;}
BUBBLES.Mobile.Utils.addClass(this.el.noMoves,"hidden");BUBBLES.Mobile.Utils.addClass(this.el.noTime,"hidden");BUBBLES.Mobile.Utils.addClass(this.el.newRecord,"hidden");BUBBLES.Mobile.Utils.removeClass(this.el.newRecord,"bounce");BUBBLES.Mobile.Utils.removeClass(this.el.newRecord,"colorBlink2");},checkLifes:function(){if(this.lifes.getAmount()<1){this.pagesRef.show("RESTORELIFES");return;}
this.lifes.animateProperHeart();setTimeout(function(){this.pagesRef.show("PLAY",function(){this.newGame();}.bind(this));}.bind(this),1500);},saveGameData:function(){var e=this.toolsShop.getBoughtTools();this.storage.setItem("CG2Tools",e.tools);this.fire("apiSpendCoins",e.coins);},newGame:function(){a();this.lifes.useLife();this.remove();var e=this;var g=BUBBLES.Mobile.Utils.cloneObj(b);this.el.stage.innerHTML=1;var f=this.toolsShop.getBoughtTools();this.saveGameData();g.lvl1.tools=f.tools;BUBBLES.Mobile.Utils.addClass(this.el.main,"stageBG1");this.userPause=false;this.game=new gems(g.lvl1,BUBBLES.Language);this.game.addListener("onUseTool",function(h,i){var j=e.storage.getItem("CG2Tools");j[i]--;e.storage.setItem("CG2Tools",j);BUBBLES.Mobile.Anal.track("/game/usetool/"+i);});this.game.addListener("onStageChange",function(h,i){BUBBLES.Mobile.Anal.track("/game/level/"+i);if(g["lvl"+i]){e.showGameInfo(BUBBLES.Language.stage+" "+i);setTimeout(e.hideGameInfo.bind(e),1000);e.game.setConfig(g["lvl"+i]);e.el.stage.innerHTML=i;BUBBLES.Mobile.Utils.removeClass(this.el.main,"stageBG"+(i-1));BUBBLES.Mobile.Utils.addClass(this.el.main,"stageBG"+i);}});this.game.addListener("onFailure",this.endGame.bind(this));},showGameInfo:function(e){this.el.gameInfo.innerHTML=e;this.el.gameInfo.style.top="25%";},hideGameInfo:function(){this.el.gameInfo.style.top="-50%";},endGame:function(e,i){var k=this;BUBBLES.Mobile.Anal.track("/game/end");var h=this.el.score.innerHTML,l=this.el.stage.innerHTML,j=this.getScore()||{};this.lastScore=h;if(+h>+(j.score||0)){BUBBLES.Mobile.Utils.removeClass(this.el.newRecord,"hidden");setTimeout(function(){BUBBLES.Mobile.Utils.addClass(k.el.newRecord,"bounce");},1);setTimeout(function(){BUBBLES.Mobile.Utils.addClass(k.el.newRecord,"colorBlink2");},1500);this.storage.setItem("CG2Score",{score:h,stage:l});}
if("no-time"===i){BUBBLES.Mobile.Utils.removeClass(this.el.noTime,"hidden");}else{BUBBLES.Mobile.Utils.removeClass(this.el.noMoves,"hidden");}
this.userPause=true;this.pagesRef.showPop("RESULT");var n=+this.getCoins(),m=Math.floor(h/500),g=Math.floor(h/100);this.el.endGainedCoins.innerHTML=m;this.el.endScore.innerHTML=h;this.el.endStage.innerHTML=l;if(+h>+(j.score||0)){this.el.submitPoints.innerHTML=h;var f=localStorage.getItem("userName");if(null!==f){this.el.nickname.value=f;}else{this.el.nickname.placeholder=BUBBLES.Language.nicknameOrName;}
this.fire("apiNewHighscore",h);}
this.fire("apiUpdateGameData",m,g,h,l);setTimeout(BUBBLES.Mobile.Utils.animateCounter.bind(this,{toEl:this.el.moneyAmount,fromVal:n,byVal:m,duration:1500}),1000);this.incExp(g);this.setCoins(n+m,true);},setDOMExp:function(i,e){if(true===e){BUBBLES.Mobile.Utils.addClass(this.el.levelProgress,"animate");}
if("100%"===this.el.levelProgress.style.width){BUBBLES.Mobile.Utils.removeClass(this.el.levelProgress,"animate");this.el.levelProgress.style.width=0;setTimeout(this.setDOMExp.bind(this,i,true));return;}
var h=this.getLevel(i),g=d(h);expNeeded=d(h+1);var f=Math.round(((i-g)*100)/expNeeded);this.el.userLevelExp.innerHTML=i;this.el.userLevelExpNeeded.innerHTML=expNeeded;this.el.levelProgress.style.width=f+"%";this.el.userLevelValue.innerHTML=h;},incExp:function(e,g){if(g){this.setExp(g);}
var k=this.getExp(),l=this.getLevel(),j=d(l+1),f=+k+e,i=this.setExp;if(f>j){var h=f-j;f=j;i=function(n,m){this.setExp(n);this.incExp(m);};}
this.setDOMExp(f);BUBBLES.Mobile.Utils.animateCounter({toEl:this.el.userLevelExp,fromVal:k,byVal:f-k,duration:1700,onComplete:i.bind(this,f,h)});}};BUBBLES.Mobile.Utils.inherit(BUBBLES.EventEmitter,c,c.prototype);return c;}());BUBBLES.API={setAPI:function(a){this._api=a;}};BUBBLES.API.General=(function(){var a=function(b){this.init(b);};a.prototype={init:function(b){if(!BUBBLES.API._api){return false;}
this.api=new BUBBLES.API._api(b);}};return a;}());BUBBLES.API.BoosterMediaAPI=(function(){var a=function(b){this.init(b);};a.prototype={init:function(b){this.appRef=b;this.registerEvents();this.setGameData();},getOAuthToken:function(){return 1;},getFrontendKey:function(){return"tot4G-"+BUBBLES.Config.fKey;},registerEvents:function(){var b=this;this.appRef.game.addListener("apiNewHighscore",function(c,d){b.showSubmit(d);});this.appRef.game.addListener("apiUpdateGameData",function(c,f,g,d,e){b.updateGameData(c,f,g,d,e);});this.appRef.game.addListener("apiSpendCoins",function(c,d){b.spendCoins(c,d);});this.appRef.addListener("apiShowLeaderBoard",this.showLeaderBoard.bind(this));this.appRef.addListener("apiSubmitScore",function(c,e,d){b.submitScore(e,d);});},showSubmit:function(b){this.appRef.pages.showPop("SUBMITSCORE");},submitScore:function(c,b){localStorage.setItem("userName",b);BUBBLES.Mobile.Spinner.show(BUBBLES.Language.sendingData,true);new BUBBLES.Mobile.XHR({fKey:this.getFrontendKey(),url:BUBBLES.Config.serverUrl+"?a=postRawScore",method:"POST",data:"nickname="+b+"&score="+c,onSuccess:function(){BUBBLES.Mobile.Spinner.hide();}}).send();},setGameData:function(){this.appRef.game.setGameData(this.getCoins(),this.getExp());},updateGameData:function(b,e,f,c,d){this.incCoins(+e);this.incExp(+f);window.par_score=c;window.par_level=d;},spendCoins:function(b,c){this.incCoins(c*-1);},incCoins:function(b){this.setCoins(this.getCoins()+parseInt(b));},getCoins:function(){return parseInt(localStorage.getItem("CG2Coins"))||0;},setCoins:function(b){localStorage.setItem("CG2Coins",+b);},incExp:function(b){this.setExp(this.getExp()+(+b));},getExp:function(){return parseInt(localStorage.getItem("CG2Exp"))||0;},setExp:function(b){localStorage.setItem("CG2Exp",+b);},handleError:function(){this.appRef.loader.progress();},showLeaderBoard:function(){this.appRef.leaderBoard.setFrontendKey(this.getFrontendKey());this.appRef.pages.show("LEADERBOARD");this.appRef.leaderBoard.getScores();}};return a;}());BUBBLES.API.setAPI(BUBBLES.API.BoosterMediaAPI);BUBBLES.Storage.prototype.sync=function(){};BUBBLES.Game.prototype.checkLifes=function(){this.pagesRef.show("PLAY",function(){this.newGame();}.bind(this));};var gemsTools=(function(){var a=function(){};a.prototype={immediatelyTools:["hint","time10","time20"],hasKabumTools:function(){for(var b in this.config.tools){if(-1===this.immediatelyTools.indexOf(b)&&this.config.tools[b]>0){return true;}}
return false;},toolChance:{color:8,bomb:24,time20:49,hint:69,time10:100},color:function(g){var f=[];for(var e=0,c=this.map.length;e<c;e++){for(var d=0,b=this.map[e].length;d<b;d++){if(this.map[e][d].type==g.type){f.push(this.map[e][d]);}}}
this.fadeElements(f);},bomb:function(b){this.fadeElements(this.kabumHelper(b));},kabumHelper:function(d){if(!d){return[];}
var c={col:d.el._col,row:d.el._row};var b=[d,this.map[c.col][c.row-1],this.map[c.col][c.row+1]];if(this.map[c.col-1]){BUBBLES.Mobile.Utils.arrayCombine(b,[this.map[c.col-1][c.row],this.map[c.col-1][c.row-1],this.map[c.col-1][c.row+1]]);}
if(this.map[c.col+1]){BUBBLES.Mobile.Utils.arrayCombine(b,[this.map[c.col+1][c.row],this.map[c.col+1][c.row+1],this.map[c.col+1][c.row-1]]);}
return b;},time10:function(){this.setTimeLeft(10);},time20:function(){this.setTimeLeft(20);},hint:function(){var b=this.hintElArr[BUBBLES.Mobile.Utils.rand(0,this.hintElArr.length-1)];BUBBLES.Mobile.Utils.addClass(b.el,"blink");setTimeout(function(){BUBBLES.Mobile.Utils.removeClass(b.el,"blink");},2100);}};return a;})();var gems=(function(){gemsClass=function(c,b){this.initialize(c,b);};var a={el:{},map:[],stage:1,activatedTool:false,actionBlocked:false,activeEl:false,timeHurry:false,lang:{},columnContainers:[],hintElArr:[],initialize:function(d,c){this.gameFinished=false;this.config=d;this.lastStageScore=0;this.totalScore=0;this.moveScore=0;this.activeNotifications=0;this.gainedTools={};if(c){this.lang=c;}
this.el={infobar:$("infobar"),toolsSwitcherText:$("toolsSwitcherText"),toolsSwitcherIcon:$("toolsSwitcherIcon"),toolsSwitcherIconContainer:$("toolsSwitcherIconContainer"),toolsSwitcher:$("toolsSwitcher"),toolsContainer:$("toolsPalette"),timeCounter:$("timeCounter"),score:$("score"),gameScoreNeeded:$("gameScoreNeeded"),main:$("main"),tools:{}};this.setgemsSize();var b=this;BUBBLES.Mobile.Events.add(this.el.main,"touchstart",function(e){b.action(e);});this.addTools(this.config.tools);this.addShopButton({id:"toolsShopButton"});this.addInfoBar();this.drawField();this.setHintEl();this.startTimer();this.setTimeLeft(0);},runBot:function(){},setConfig:function(c){for(var b in c){this.config[b]=c[b];}},startTimer:function(){if(true===this.gameFinished){return false;}
var b=this;this.mainTimer=setInterval(function(){b.setTimeLeft(-1);},1000);},stopTimer:function(){clearInterval(this.mainTimer);},setgemsSize:function(){this.config.size=Math.floor(this.el.main.offsetWidth/this.config.mapSize.x);var b=document.createElement("style");b.textContent=".box {width: "+this.config.size+"px; height: "+this.config.size+"px;}";document.getElementsByTagName("head")[0].appendChild(b);},remove:function(){this.stopTimer();this.el.main.innerHTML="";this.el.main.className="main";this.el.infobar.innerHTML="";this.el.score.innerHTML="0";this.el.toolsContainer.innerHTML="";this.el.gameScoreNeeded.style.width=0;BUBBLES.Mobile.Utils.addClass(this.el.toolsSwitcherIconContainer,"hidden");BUBBLES.Mobile.Utils.removeClass(this.el.timeCounter,"hurry");this.el.toolsSwitcherText.innerHTML=this.lang.tools;this.el.toolsContainer.style.display="none";BUBBLES.Mobile.Utils.cleanElement(this.el.main);BUBBLES.Mobile.Utils.cleanElement(this.el.toolsContainer);BUBBLES.Mobile.Utils.cleanElement(this.el.toolsSwitcher,true);},addInfoBar:function(){this.el.score.innerHTML="0";this.el.toolsSwitcherText.innerHTML=this.lang.tools;BUBBLES.Mobile.Events.tap({element:this.el.toolsSwitcher,action:this.toogleTools.bind(this)});},addTools:function(c){if(!this.el.toolsContainer){return false;}
var e=this;BUBBLES.Mobile.Events.add(this.el.toolsContainer,"touchstart",function(f){e.activateTool(f);});var b=document.createElement("div");b.className="toolsContainerInner";b.id="toolsContainerInner";this.el.toolsContainerInner=b;this.el.toolsContainer.appendChild(b);var b=document.createElement("div");b.className="greyBG";this.el.toolsContainer.appendChild(b);for(var d in c){this.addTool(d,c[d]);}},addShopButton:function(c){if(c&&c.id){var b=document.createElement("div");b.className="toolShopButton button";b.id="toolShopButton";b.innerHTML=this.lang.getMoreTools;this.el.toolsContainerInner.appendChild(b);}},addTool:function(d,c){var f=this.el.tools[d];if(!f){var b=document.createElement("div");b.className="toolContainer";b.id="toolContainer_"+d;var e={};e.main=document.createElement("div");e.main.className="tool toolIcon_"+d;e.main.id="tool_"+d;e.count=document.createElement("div");e.count.className="toolCount";this.el.tools[d]=e;b.appendChild(this.el.tools[d].main);b.appendChild(this.el.tools[d].count);this.el.toolsContainerInner.appendChild(b);}
this.el.tools[d].count.innerHTML=c;if(0==c){BUBBLES.Mobile.Utils.addClass(this.el.tools[d].main,"inactive");}else{BUBBLES.Mobile.Utils.removeClass(this.el.tools[d].main,"inactive");}},toogleTools:function(b){if(this.activatedTool){return this.deactivateTool();}
if("block"==this.el.toolsContainer.style.display){if(true!==b){this.el.toolsSwitcherText.innerHTML=this.lang.tools;}
this.startTimer();return this.el.toolsContainer.style.display="none";}
this.el.toolsSwitcherText.innerHTML=this.lang.cancel;this.stopTimer();return this.el.toolsContainer.style.display="block";},drawField:function(){for(var e=1;e<=this.config.mapSize.y;e++){this.columnContainers[e]=document.createElement("div");this.columnContainers[e].className="ColumnContainer";this.columnContainers[e].id="ColumnContainer"+e;this.el.main.appendChild(this.columnContainers[e]);}
var c,b,g;for(e=0;e<this.config.mapSize.x;e++){this.map[e]=[];for(c=0,b=this.config.mapSize.y;c<b;c++){g=this.getRandomType(true);this.map[e][c]=this.buildMapObj(g,this.addElement(g,e,c));}}
var d,f;while(this.getElToRemove().length>0){f=this.getElToRemove();while(f.length>2){f.shift();f.shift();d=f.shift();BUBBLES.Mobile.Utils.removeClass(d.el,"type"+d.type);d.type=this.getRandomType(true);BUBBLES.Mobile.Utils.addClass(d.el,"type"+d.type);}}},buildMapObj:function(b,c){return{type:b,el:c};},addElement:function(b,c,f,e){var d="type"+b;return this.addDOMEl("box "+d,c,f,e);},addDOMEl:function(b,c,f,e){var d=e||document.createElement("div");d.style.left=this.config.size*c+"px";d.style.top=this.config.size*f+"px";d._col=c;d._row=f;d.className=b;if(!e){this.el.main.appendChild(d);}
return d;},getGemByElement:function(b){return this.map[b._col][b._row];},action:function(b){if(true===this.actionBlocked||true===this.gameFinished){return false;}
var c=b.changedTouches?b.changedTouches[0].target:b.target;if(!c||BUBBLES.Mobile.Utils.hasClass(c,"notification")){return false;}
var e=this.getGemByElement(c);c=e.el;if(this.activatedTool){this.fire("onTryUseTool",[this.activatedTool,c]);this.useTool(this.activatedTool,c);return true;}
var d=this.activeEl;if(!d){return this.activateEl(c);}
if(this.switchEl(d,c)){this.activeEl=false;if(false===this.check(true)){setTimeout(this.switchEl.bind(this,d,c),200);}}else{BUBBLES.Mobile.Utils.removeClass(d,"active");this.activateEl(c);}},activateEl:function(b){this.fire("onSelectGem");BUBBLES.Mobile.Utils.addClass(b,"active");this.activeEl=b;},switchEl:function(h,e){if(h==e){BUBBLES.Mobile.Utils.removeClass(h,"active");return false;}
if(false==this.checkFinish()){return false;}
var g=false;var f={from:{col:h._col,row:h._row},to:{col:e._col,row:e._row}};if(f.from.col==f.to.col){if(-1!==[f.from.row-1,f.from.row+1].indexOf(f.to.row)){g="top";}}else{if(f.from.row==f.to.row){if(-1!==[f.from.col-1,f.from.col+1].indexOf(f.to.col)){g="left";}}}
if(!g){return false;}
this.fire("onSwitchEl");BUBBLES.Mobile.Utils.removeClass(h,"active");var c=this.getGemByElement(h);var d=this.getGemByElement(e);this.map[f.from.col][f.from.row]=d;this.map[f.to.col][f.to.row]=c;h._col=f.to.col;h._row=f.to.row;e._col=f.from.col;e._row=f.from.row;var b={from:h.style[g],to:e.style[g]};h.style[g]=b.to;e.style[g]=b.from;return true;},check:function(c){this.actionBlocked=true;var b=this.getElToRemove();this.moveScore=0;if(0==b.length){this.actionBlocked=false;}
if(true===c&&0==b.length){return false;}
this.setTimeLeft(this.config.timeInc);setTimeout(this.fadeElements.bind(this,b),180);},getElToRemove:function(){var d=[];for(var c=0,b=this.map.length;c<b;c++){d=BUBBLES.Mobile.Utils.arrayCombine(d,this.checkHelper(c,true));d=BUBBLES.Mobile.Utils.arrayCombine(d,this.checkHelper(c,false));}
return d;},checkHelper:function(h,b){var g,e,j,d=[],f=[];var c=0;do{if(true==b){g=this.map[h][c];}else{if(this.map[c]){g=this.map[c][h];}else{g=false;}}
if(g&&(!e||g.type==e.type||0===g.type)){d.push(g);}else{if(d.length>2){f=BUBBLES.Mobile.Utils.arrayCombine(f,d);}
if(g&&0!=g.type){d=[g];if(j){d.push(j);}}}
if(g){if(0!=g.type){e=g;j=false;}else{j=g;}}
c++;}while(g);return f;},checkFutureMoves:function(h,c){var g,f,b,d=false;var e=0;do{if(true==c){g=this.map[h][e];b=this.map[h][e+1];}else{if(this.map[e]){g=this.map[e][h];if(this.map[e+1]){b=this.map[e+1][h];}}else{g=false;}}
if(g&&f&&(g.type==f.type||0===g.type)){d=this.checkFutureMovesHelper(f,true,c);if(!d){d=this.checkFutureMovesHelper(g,false,c);}}else{if(!d&&g&&f&&b&&(b.type==f.type||0===b.type)){d=this.checkFutureMovesHelper(b,true,c,true);}}
if(d){break;}
if(g&&0!==g.type){f=g;}
e++;}while(g);return d;},checkFutureMovesHelper:function(h,c,b,g){var f=1,d;var e={col:h.el._col,row:h.el._row};if(c){f=-1;}
if(true===b){d=this.map[e.col-1];if(d){d=d[e.row+1*f];}
if(d&&(d.type==h.type||0===d.type)){return d;}
d=this.map[e.col+1];if(d){d=d[e.row+1*f];}
if(d&&(d.type==h.type||0===d.type)){return d;}
if(true!==g){d=this.map[e.col];if(d){d=d[e.row+2*f];}
if(d&&(d.type==h.type||0===d.type)){return d;}}
return false;}
d=this.map[e.col+1*f];if(d){d=d[e.row-1];}
if(d&&(d.type==h.type||0===d.type)){return d;}
d=this.map[e.col+1*f];if(d){d=d[e.row+1];}
if(d&&(d.type==h.type||0===d.type)){return d;}
if(true!==g){d=this.map[e.col+2*f];if(d){d=d[e.row];}
if(d&&(d.type==h.type||0===d.type)){return d;}}
return false;},fadeElements:function(e){if(!e||e.length<1){this.checkFinish(true);return false;}
for(var d=0,b=e.length;d<b;d++){var c=e[d];if(!c){continue;}
BUBBLES.Mobile.Utils.addClass(c.el,"disappear");}
setTimeout(this.afterFadeElements.bind(this,e),150);},afterFadeElements:function(g){var j={};for(var e=0,b=g.length;e<b;e++){var d=g[e];if(!d){continue;}
var c=d.el;c.className="";this.setScore();this.fire("onFadeElements");var h={col:c._col,row:c._row};BUBBLES.Mobile.Utils.arrayErase(this.map[h.col],d);d=null;j[h.col]=++j[h.col]||1;var f=this.getRandomType();this.map[h.col].unshift(this.buildMapObj(f,this.addElement(f,h.col,j[h.col]*-1,c)));}
this.moveAll();},getRandomType:function(b){return BUBBLES.Mobile.Utils.rand(1,this.config.gemCount);},moveAll:function(){var f,d,e,c,b,g;for(f=0,e=this.map.length;f<e;f++){b=this.map[f];for(d=0,c=b.length;d<c;d++){g=b[d];var h={col:g.el._col,row:g.el._row};var l=this.map[h.col].indexOf(g);if(l==h.row){continue;}
var k=l-h.row;this.columnContainers[k].appendChild(g.el);h.row=l;g.el._col=h.col;g.el._row=h.row;}}
for(f=1;f<=this.config.mapSize.y;f++){if(!this.columnContainers[f].children[0]){continue;}
this.columnContainers[f].style.top=f*this.config.size+"px";}
setTimeout(this.moveAllFinish.bind(this),180);},moveAllFinish:function(){var d,c,b;for(var f=1;f<=this.config.mapSize.y;f++){var e=Array.prototype.slice.call(this.columnContainers[f].children);if(!e[0]){continue;}
for(d=0,c=e.length;d<c;d++){this.el.main.appendChild(e[d]);b=parseInt(e[d].style.top);e[d].style.top=f*this.config.size+b+"px";}
this.columnContainers[f].style.top=0;}
this.check();},checkFinish:function(b){this.checkChangeStage();if(b){if(this.el.score.innerHTML!=this.totalScore){this.el.score.innerHTML=this.totalScore;this.updateScoreProgress();}
this.setHintEl();if(0===this.hintElArr.length){if(this.hasKabumTools()){this.config.onHaveToUseTool();}else{this.gameFinished=true;this.fire("onFailure","no-gems");return false;}}}
return true;},setTimeLeft:function(b){b=b<0?b*this.config.timeMultiplier:b;this.config.time+=b;this.config.time=this.config.time<0?0:this.config.time;this.config.time=this.config.maxTime<this.config.time?this.config.maxTime:this.config.time;this.el.timeCounter.innerHTML=this.config.time;if(this.config.time<10){BUBBLES.Mobile.Utils.addClass(this.el.timeCounter,"hurry");this.timeHurry=true;}else{if(true===this.timeHurry&&this.config.time>10){BUBBLES.Mobile.Utils.removeClass(this.el.timeCounter,"hurry");}}
if(this.config.time<1&&true!==this.gameFinished){this.stopTimer();this.gameFinished=true;this.fire("onFailure","no-time");return false;}},setHintEl:function(){this.hintElArr=[];var d;for(var c=0,b=this.map.length;c<b;c++){d=this.checkFutureMoves(c,true);if(d){this.hintElArr.push(d);}
d=this.checkFutureMoves(c,false);if(d){this.hintElArr.push(d);}}},setScore:function(){this.moveScore+=10;this.totalScore+=this.moveScore;},updateScoreProgress:function(){var b=((this.totalScore-this.lastStageScore)*100)/this.config.pointsPerStage;b=b<1?0:b;this.el.gameScoreNeeded.style.width=b+"%";},activateTool:function(b){var f=b.changedTouches?b.changedTouches[0].target:b.target;if(f.nodeType===Node.TEXT_NODE){f=f.parentNode;}
if(!f||BUBBLES.Mobile.Utils.hasClass(f,"inactive")){this.toogleTools();return false;}
var e=f.getAttribute("id");if(!e||e==="toolsPalette"||e==="toolsContainerInner"){this.toogleTools();return false;}
this.toogleTools(true);var d=e.match(/tool_(\w+)/);if(d&&d[1]){if(this.activatedTool==d[1]){return this.deactivateTool();}
this.activatedTool=d[1];var c=-1!==this.immediatelyTools.indexOf(this.activatedTool);this.fire("onActivateTool",c);if(c){this.fire("onTryUseTool",this.activatedTool);this.useTool(this.activatedTool);return true;}
BUBBLES.Mobile.Utils.removeClass(this.el.toolsSwitcherIconContainer,"hidden");this.el.toolsSwitcherIcon.src="img/game/"+this.activatedTool+".png";}},deactivateTool:function(){if(!this.activatedTool){return false;}
BUBBLES.Mobile.Utils.addClass(this.el.toolsSwitcherIconContainer,"hidden");this.el.toolsSwitcherText.innerHTML=this.lang.tools;this.activatedTool=false;},useTool:function(b,d){if(this.config.tools[b]<1){return false;}
this.fire("onUseTool",b);this.deactivateTool();this.addTool(b,--this.config.tools[b]);var c;if(d){c=this.getGemByElement(d);}
this[b](c);},checkChangeStage:function(){var b=Math.floor((this.totalScore-this.lastStageScore)/this.config.pointsPerStage);if(b>0){this.lastStageScore+=this.config.pointsPerStage;this.stage++;this.fire("onStageChange",this.stage);}}};BUBBLES.Mobile.Utils.inherit(gemsTools,gemsClass,a);BUBBLES.Mobile.Utils.implement(BUBBLES.EventEmitter,gemsClass,gemsClass.prototype);return gemsClass;}());