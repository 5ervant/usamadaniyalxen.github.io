var gamits=gamits||{};gamits.parts=function(){var screen,$status,videoInterval,public={},locked=0,arrCanvases=[],arrContainers=[],thouArtVictorious=!1,PUZZLE_WIDTH=600,PUZZLE_HEIGHT=300,CELL_WIDTH=100,CELL_HEIGHT=100,NUMBER_OF_CELLS=PUZZLE_WIDTH/CELL_WIDTH*(PUZZLE_HEIGHT/CELL_HEIGHT);public.init=function(){screen=document.getElementById("screen"),$status=$("#status"),_redirectNonSupported(),_trackLoadingProgress(),_initPieces(),_initMuteButton(),_initReplayButton(),videoInterval=setInterval(_translateVideoToPieces,33),screen.addEventListener("ended",function(){thouArtVictorious?$("#replay-btn").fadeIn("fast"):_fail()},!1)};var _download=function(t){if(0!=$(t.currentTarget).length){arr=new Array,arr[0]="e",arr[1]="i",arr[2]="g",arr[3]="h",arr[4]="t",arr[5]="e",arr[6]="e",arr[7]="n",arr[8]="-",arr[9]="p",arr[10]="i",arr[11]="e",arr[12]="c",arr[13]="e",arr[14]="s";for(var e="",a=0;a<arr.length;a++)e+=arr[a];window.location.href="data/downloads/"+e+".zip"}},_redirectNonSupported=function(){var t=!0;Modernizr.canvas&&Modernizr.video&&Modernizr.audio||(t=!1),(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i))&&(t=!1),navigator.userAgent.toLowerCase().match(/android/i)&&(t=!1),navigator.userAgent.toLowerCase().match(/windows ce/i)&&(t=!1),navigator.userAgent.toLowerCase().match(/blackberry/i)&&(t=!1),navigator.userAgent.toLowerCase().match(/palm/i)&&(t=!1),t||(window.location.href="alternate.html")},_trackLoadingProgress=function(){function t(){$status.stop().animate({top:"-150px"},1e3,"easeInOutExpo",function(){$("#indicator").attr("src","data/images/arrow.gif"),$("#loader").css("cursor","pointer").click(function(){$("#loading").animate({width:"1px"},1e3,"easeOutExpo",function(){$(this).hide(),screen.play()})})})}screen.addEventListener("loadeddata",function(){$status.stop().animate({top:"0px"},1e3,"easeInOutExpo")},!1),screen.addEventListener("canplaythrough",function(){$status.stop().animate({top:"-75px"},1e3,"easeInOutExpo",function(){setTimeout(t,400)})},!1),4==screen.readyState&&t()},_initPieces=function(){for(var i=0;NUMBER_OF_CELLS>i;i++){with(arrCanvases[i]=document.createElement("canvas"),arrCanvases[i])id="cell-"+i,width=CELL_WIDTH,height=CELL_HEIGHT;document.getElementById("main").appendChild(arrCanvases[i]);var rotation=Math.ceil(90*Math.random())-45,randomPoint=_getRandomPoint(i,$("#puzzle").offset().left,$("#puzzle").offset().top,$("#puzzle").outerWidth()+$("#puzzle").offset().left,$("#puzzle").outerHeight()+$("#puzzle").offset().top,$(window).width(),$(window).height());with($("#cell-"+i).css({position:"absolute",top:randomPoint.y+"px",left:randomPoint.x+"px","-moz-transform":"rotate("+rotation+"deg)","-webkit-transform":"rotate("+rotation+"deg)"}),$("#cell-"+i).draggable(),arrContainers[i]=document.createElement("div"),arrContainers[i])id="container-"+i;document.getElementById("puzzle").appendChild(arrContainers[i]),$("#container-"+i).css({width:CELL_WIDTH+"px",height:CELL_HEIGHT+"px","float":"left"}),$("#container-"+i).droppable({accept:"#cell-"+i,drop:function(t,e){e.draggable.css({position:"static","-moz-transform":"rotate(0deg)","-webkit-transform":"rotate(0deg)"}).draggable("option","disabled","true"),$(this).css({width:CELL_WIDTH+"px",height:CELL_HEIGHT+"px",border:"none"}).append(e.draggable).droppable("option","disabled","true"),locked++,locked==NUMBER_OF_CELLS&&_ftw()}})}},_initMuteButton=function(){$("#mute-btn").click(function(){screen.muted?(screen.muted=!1,$(this).css("background-position","0px 0px")):(screen.muted=!0,$(this).css("background-position","0px -40px"))})},_initReplayButton=function(){$("#replay-btn").click(function(){$(this).fadeOut("fast"),screen.currentTime=0,screen.paused&&screen.play()})},_translateVideoToPieces=function(){if(screen.readyState>=3){for(var t=new Array,e=0,a=0,r=0;NUMBER_OF_CELLS>r;r++)0!=r&&r%Math.floor(PUZZLE_WIDTH/CELL_WIDTH)==0&&(e++,a=0),t[r]=arrCanvases[r].getContext("2d"),t[r].clearRect(0,0,CELL_WIDTH,CELL_HEIGHT),t[r].drawImage(screen,a*CELL_WIDTH,e*CELL_HEIGHT,CELL_WIDTH,CELL_HEIGHT,0,0,CELL_WIDTH,CELL_HEIGHT),a++;_updateTime()}},_updateTime=function(){if("NaN"!=screen.duration){var t=screen.duration-screen.currentTime,e=Math.floor(t/60),a=Math.floor(t)%60<10?"0"+Math.floor(t)%60:Math.floor(t)%60;$("#countdown").text("0"+e+":"+a)}},_getRandomPoint=function(t,e,a,r,n,i,o){var s=Math.round(Math.random()),c={};switch(0==s?(c.x=t%2==0?e-CELL_WIDTH:r,c.y=Math.ceil(a+Math.random()*(n-a))):(c.y=t%2==0?a-CELL_HEIGHT:n,c.x=Math.ceil(e+Math.random()*(r-e))),c.x){case e-CELL_WIDTH:c.x=c.x-Math.ceil(Math.random()*(e-(CELL_WIDTH+15)));break;case r:c.x=c.x+Math.ceil(Math.random()*(i-(CELL_WIDTH+15)-c.x))}switch(c.y){case a-CELL_HEIGHT:c.y=c.y-Math.ceil(Math.random()*(a-(CELL_HEIGHT+15)));break;case n:c.y=c.y+Math.ceil(Math.random()*(o-(CELL_HEIGHT+15)-c.y))}return c},_fail=function(){for(var t=0;NUMBER_OF_CELLS>t;t++)$("#cell-"+t).draggable("destroy");$("#fail").animate({left:"0px"},750,"swing")},_ftw=function(){thouArtVictorious=!0,$("#download").click(_download),$("#win").animate({left:"0px"},750,"swing")};return public}(),$(document).ready(gamits.parts.init);